# 🎯 Cursor AI 虚拟环境配置指南

## ✅ 已完成的配置

我已经为你创建了以下配置文件：

1. **`.vscode/settings.json`** - Cursor 工作区配置
2. **`.vscode/README.md`** - 详细配置说明
3. **`test_venv_config.py`** - 测试脚本（验证配置是否生效）

## 🚀 让配置生效的步骤

### 方法 1: 重新加载窗口（推荐，最快）

1. 按 `Ctrl + Shift + P` 打开命令面板
2. 输入 `reload` 或 `Developer: Reload Window`
3. 按回车执行

### 方法 2: 重启 Cursor

直接关闭 Cursor 并重新打开项目

### 方法 3: 手动选择 Python 解释器

1. 按 `Ctrl + Shift + P`
2. 输入 `Python: Select Interpreter`
3. 选择 `./venv/Scripts/python.exe`

## 🧪 验证配置

配置生效后，打开新终端并运行测试：

```powershell
# 方法1: 直接运行（如果虚拟环境已激活）
python test_venv_config.py

# 方法2: 显式使用虚拟环境
./venv/Scripts/python.exe test_venv_config.py
```

### 期望的输出

如果配置正确，你应该看到：

```
============================================================
🔍 虚拟环境配置检查
============================================================

1️⃣  Python 解释器路径:
   D:\pythonProject\数据源\venv\Scripts\python.exe

2️⃣  虚拟环境状态:
   ✅ 正在使用虚拟环境

...

📊 总结
============================================================
✅ 配置正确！Cursor AI 正在使用项目虚拟环境
   您可以放心地使用 AI 进行开发和测试
```

## 🔍 配置文件详解

### `.vscode/settings.json` 关键配置

```json
{
    // 指定 Python 解释器为虚拟环境
    "python.defaultInterpreterPath": "${workspaceFolder}/venv/Scripts/python.exe",
    
    // 终端自动激活虚拟环境
    "python.terminal.activateEnvironment": true,
    
    // PowerShell 启动时自动运行激活脚本
    "terminal.integrated.profiles.windows": {
        "PowerShell": {
            "args": [
                "-NoExit",
                "-Command",
                "& '${workspaceFolder}/venv/Scripts/Activate.ps1'"
            ]
        }
    }
}
```

## 📝 终端使用

### PowerShell 终端

当你打开新终端时，应该看到：

```powershell
(venv) PS D:\pythonProject\数据源>
```

**`(venv)` 前缀表示虚拟环境已激活！**

### 如果终端没有自动激活

手动激活虚拟环境：

```powershell
# PowerShell
./venv/Scripts/Activate.ps1

# 或 CMD
.\venv\Scripts\activate.bat
```

### PowerShell 执行策略问题

如果遇到 "无法加载文件，因为在此系统上禁止运行脚本" 错误：

```powershell
# 以管理员身份运行 PowerShell，执行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## 🤖 Cursor AI 自动使用虚拟环境

配置完成后，当 Cursor AI 执行以下操作时会自动使用虚拟环境：

✅ **运行 Python 脚本**
```python
# AI 会使用: D:\pythonProject\数据源\venv\Scripts\python.exe
```

✅ **安装包**
```bash
# AI 会使用虚拟环境的 pip
pip install pandas
```

✅ **执行测试**
```bash
# 自动使用虚拟环境中的 pytest
pytest tests/
```

✅ **代码检查**
```bash
# 使用虚拟环境中的 pylint/flake8
pylint your_script.py
```

## 🎯 实际示例

### 示例 1: AI 运行脚本

当你对 AI 说：**"帮我运行 escape_top_scorer.py"**

AI 会执行：
```powershell
(venv) PS D:\pythonProject\数据源> python src/大盘逃顶/escape_top_scorer.py
```

使用的是虚拟环境中的 Python 和已安装的包。

### 示例 2: AI 安装依赖

当你对 AI 说：**"安装 matplotlib"**

AI 会执行：
```powershell
(venv) PS D:\pythonProject\数据源> pip install matplotlib
```

包会安装到虚拟环境的 `site-packages` 目录。

### 示例 3: AI 测试代码

当你对 AI 说：**"测试数据下载功能"**

AI 会创建测试脚本并运行，使用虚拟环境中的依赖。

## 🔧 故障排除

### 问题 1: 终端没有 (venv) 前缀

**解决方案：**
1. 关闭所有终端窗口（点击终端右上角的 × 或垃圾桶图标）
2. 按 `Ctrl + Shift + P` → `Terminal: Kill All Terminals`
3. 打开新终端 `Ctrl + ~`

### 问题 2: AI 仍使用系统 Python

**解决方案：**
1. 确认已重新加载窗口或重启 Cursor
2. 检查 `.vscode/settings.json` 文件存在且内容正确
3. 手动选择解释器：`Ctrl + Shift + P` → `Python: Select Interpreter` → `./venv/Scripts/python.exe`

### 问题 3: 找不到已安装的包

**解决方案：**
```powershell
# 激活虚拟环境
./venv/Scripts/Activate.ps1

# 检查包是否安装
pip list

# 如果缺少包，重新安装
pip install -r requirements.txt
```

### 问题 4: 虚拟环境损坏

**解决方案：**
```powershell
# 1. 删除旧的虚拟环境
Remove-Item -Recurse -Force venv

# 2. 重新创建虚拟环境
python -m venv venv

# 3. 激活并安装依赖
./venv/Scripts/Activate.ps1
pip install -r requirements.txt
```

## 📚 配置文件位置

```
D:\pythonProject\数据源\
├── .vscode/
│   ├── settings.json          # 主配置文件
│   └── README.md              # 详细说明
├── venv/                       # 虚拟环境目录
│   └── Scripts/
│       ├── python.exe         # Python 解释器
│       ├── pip.exe            # 包管理器
│       └── Activate.ps1       # 激活脚本
├── test_venv_config.py        # 测试脚本
├── requirements.txt           # 项目依赖
└── 虚拟环境配置指南.md        # 本文档
```

## 🎓 推荐工作流程

### 每次开始工作

1. **打开 Cursor**
2. **检查终端是否有 (venv) 前缀**
3. 如果没有，手动激活：
   ```powershell
   ./venv/Scripts/Activate.ps1
   ```
4. **开始使用 Cursor AI 进行开发**

### 定期检查

定期运行测试脚本确保配置正确：

```powershell
python test_venv_config.py
```

## 💡 小贴士

1. **首选项同步**：如果使用 Cursor 的设置同步功能，这些配置会在其他机器上生效
2. **团队协作**：提交 `.vscode/settings.json` 到代码仓库，团队成员都能使用相同配置
3. **多项目管理**：每个项目都可以有自己的虚拟环境配置
4. **性能优化**：虚拟环境可以隔离依赖，避免包冲突，提高稳定性

## ✨ 下一步

配置完成后，你可以：

1. ✅ 让 Cursor AI 帮你运行和测试代码
2. ✅ 安全地安装新的 Python 包
3. ✅ 使用 AI 进行代码调试和优化
4. ✅ 确保所有操作都在隔离的虚拟环境中进行

---

**需要帮助？** 运行 `python test_venv_config.py` 查看当前配置状态

