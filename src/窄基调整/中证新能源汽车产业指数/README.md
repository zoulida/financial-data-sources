# 中证新能源汽车产业指数新纳入股票表现分析

## 项目说明

本项目用于分析中证新能源汽车产业指数（930997）新纳入股票在**数据截止日**和**生效日**前后5个交易日的表现，包括股价涨跌幅和成交量变化。

## 文件结构

```
中证新能源汽车产业指数/
├── 930997_changes_20240101_20251024.csv    # 指数调整数据
├── analyze_newly_included_stocks.py         # 主分析脚本
├── test_analyzer.py                         # 测试脚本
├── 指数调整日期.md                          # 调整规则说明
└── README.md                               # 本文件
```

## 核心功能

### 1. 数据准备
- 读取指数调整CSV文件
- 筛选出`tradestatus='纳入'`的股票
- 计算数据截止日（生效日前第二个自然月的最后一个自然日）

### 2. 交易日历获取
- 使用XtQuant API获取A股交易日历
- 计算每个关键日期前后5个交易日的观察窗口

### 3. 行情数据获取
- 使用XtQuant API获取股票收盘价和成交量数据
- 支持批量获取多只股票的历史数据

### 4. 表现指标计算
- **涨跌幅**：每日相对前一日的涨跌幅
- **累计涨跌幅**：观察期内的总涨跌幅
- **成交量变化率**：相对观察期均值的变化
- **胜率**：上涨天数占比
- **波动率**：涨跌幅的标准差

### 5. 统计汇总报告
- 按调整批次分组统计
- 平均涨跌幅、胜率、成交量变化等指标
- 对比数据截止日窗口和生效日窗口的差异

## 使用方法

### 1. 环境准备

确保已安装必要的Python包：
```bash
pip install pandas numpy xtquant
```

### 2. 配置XtQuant Token

在`analyze_newly_included_stocks.py`中设置你的XtQuant token：
```python
xtdata.set_token('your_token_here')  # 替换为实际的token
```

### 3. 运行测试

首先运行测试脚本验证环境配置：
```bash
python test_analyzer.py
```

### 4. 运行完整分析

```bash
python analyze_newly_included_stocks.py
```

## 输出文件

分析完成后会生成以下文件：

1. **newly_included_performance_detail.csv**
   - 每只股票的详细表现数据
   - 包含各交易日的涨跌幅、成交量等

2. **newly_included_summary_cutoff_date.csv**
   - 数据截止日窗口的统计汇总
   - 按调整批次分组的平均指标

3. **newly_included_summary_effective_date.csv**
   - 生效日窗口的统计汇总
   - 按调整批次分组的平均指标

4. **newly_included_overall_summary.txt**
   - 综合分析报告
   - 包含总体统计和详细分析

## 分析结果示例

### 总体统计
- 数据截止日窗口平均累计涨跌幅：X.XX%
- 生效日窗口平均累计涨跌幅：X.XX%
- 平均胜率：XX.XX%

### 按调整批次统计
- 2024-06-17调整批次：X只股票，平均涨跌幅X.XX%
- 2024-12-16调整批次：X只股票，平均涨跌幅X.XX%
- 2025-06-16调整批次：X只股票，平均涨跌幅X.XX%

## 关键日期映射

根据指数调整规则：
- 2024-06-17生效 → 数据截止日 2024-04-30
- 2024-12-16生效 → 数据截止日 2024-10-31
- 2025-06-16生效 → 数据截止日 2025-04-30

## 注意事项

1. **数据源优先级**：按照项目规则，优先使用XtQuant获取行情数据
2. **交易日历**：如果XtQuant获取交易日历失败，会自动使用工作日作为替代
3. **数据完整性**：确保CSV文件包含完整的调整数据
4. **网络连接**：需要稳定的网络连接访问XtQuant API

## 故障排除

### 常见问题

1. **XtQuant连接失败**
   - 检查网络连接
   - 验证token是否正确
   - 确认XtQuant服务状态

2. **数据获取失败**
   - 检查股票代码格式
   - 确认日期范围是否合理
   - 查看错误日志信息

3. **交易日历获取失败**
   - 脚本会自动使用工作日作为替代
   - 不影响基本功能运行

## 扩展功能

可以根据需要扩展以下功能：
- 添加更多技术指标（RSI、MACD等）
- 支持更多指数分析
- 增加可视化图表
- 添加异常检测功能

## 联系信息

如有问题或建议，请联系项目维护者。
