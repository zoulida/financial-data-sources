# 窄基前60名指数分析项目总结

## 项目概述

本项目分析窄基前60名指数的成分股变动情况，统计新纳入股票在数据截止日和生效日前后5个交易日的表现。

## 已完成工作

### 1. 数据准备

#### 指数列表
- 文件: `zhaiji_top_indices_list.csv`
- 包含: 60个窄基指数（按基金规模排序）
- 筛选条件: 排除港股通指数、综合指数、全指类指数

#### 前10名指数
1. 证券公司 (399975.SZ) - 968.41亿元
2. 国证芯片 (980017.CNI) - 491.03亿元
3. 中证医疗 (399989.SZ) - 402.06亿元
4. 中证白酒 (399997.SZ) - 397.00亿元
5. 红利低波 (h30269.CSI) - 384.45亿元
6. CS人工智能 (930713.CSI) - 373.18亿元
7. 中证银行 (399986.SZ) - 347.65亿元
8. 中证军工 (399967.SZ) - 340.46亿元
9. 机器人 (h30590.CSI) - 304.30亿元
10. 中证红利 (000922.CSI) - 275.64亿元

### 2. 程序开发

#### 核心程序
1. **download_changes.py** - 下载指数变动数据
   - 使用 Wind API 获取指数成分股变动历史
   - 自动跳过已下载数据
   - 生成下载汇总报告

2. **analyze_performance.py** - 分析股票表现
   - 使用项目数据下载模块获取股票K线数据
   - 计算数据截止日和生效日
   - 分析新纳入股票在关键日期的表现

3. **check_api.py** - API可用性检查
   - 检查 Wind API（下载变动数据需要）
   - 检查项目数据下载模块（分析股票表现需要）

#### 辅助文件
- `filter_narrow_indices.py` - 筛选窄基指数
- `zhaiji_top_indices_list.csv` - 指数列表数据
- `README.md` - 使用说明文档
- `CHANGES_SUMMARY.md` - 修改总结
- 批处理文件: `run_download.bat`, `run_analysis.bat`, `check_api.bat`

### 3. 分析方法

#### 关键日期计算
- **数据截止日** = 生效日前第二个自然月的最后一个自然日
- **观察窗口** = 中心日期前后各5个交易日（共11个交易日）

#### 分析指标
对每只新纳入的股票计算以下指标：
1. 涨跌幅指标
   - 平均日涨跌幅
   - 累计涨跌幅
   - 最大/最小日涨跌幅
   - 波动率

2. 胜率指标
   - 上涨天数占比

3. 成交量指标
   - 成交量变化率

## 输出结果

### 生成的文件

#### 1. 变动数据文件
- 格式: `{指数名称}_{指数代码}_changes.csv`
- 示例: `证券公司_399975.SZ_changes.csv`
- 包含: 股票代码、名称、变动类型、日期、权重、涨跌幅等

#### 2. 下载汇总报告
- 文件: `download_summary.csv`
- 内容: 各指数的变动记录数、新纳入数、剔除数

#### 3. 分析结果文件

**详细结果:** `zhaiji_stocks_performance.csv`
- 各股票的详细表现数据
- 包含: 指数信息、股票代码、观察窗口、各项指标

**汇总报告:** `zhaiji_summary.csv`
- 按指数汇总的统计指标
- 平均累计涨跌幅、胜率等

## 技术实现

### 数据流架构

```
步骤1: Wind API
    ↓
download_changes.py
    ↓
生成 *_changes.csv 文件
    ↓
步骤2: 项目数据下载模块
    ↓
analyze_performance.py
    ↓
调用 getDayData() 获取股票K线
    ↓
分析数据截止日窗口表现
分析生效日窗口表现
    ↓
生成 zhaiji_stocks_performance.csv
生成 zhaiji_summary.csv
```

### 关键技术点

1. **数据源选择**
   - 变动数据: Wind API (需要Wind终端)
   - 股票K线: 项目数据模块 (迅投XTQuant接口)
   - 优势: 使用缓存机制，避免重复下载

2. **超时机制**
   - 使用装饰器 `@with_timeout(2)` 避免卡死
   - 自动重试机制（最多3次）

3. **数据验证**
   - 检查数据完整性
   - 处理缺失数据
   - 跳过无效股票

## 使用方式

### 快速开始

```bash
# 进入目录
cd "D:\pythonProject\数据源\src\窄基调整\窄基前60名"

# 步骤0: 检查API（推荐）
python check_api.py

# 步骤1: 下载变动数据（需要Wind终端）
python download_changes.py

# 步骤2: 分析股票表现
python analyze_performance.py
```

### 批处理方式
1. 先运行 `check_api.bat` 检查API
2. 再运行 `run_download.bat` 下载数据
3. 最后运行 `run_analysis.bat` 进行分析

## 数据说明

### 时间范围
- 开始日期: 2023-01-01
- 结束日期: 当前日期

### 指数数量
- 总指数数: 60个
- 排除类型:
  - 港股通指数
  - 综合指数（沪深300、中证500等）
  - 全指、全市场类指数

### 观察周期
- 数据截止日窗口: 前后各5个交易日
- 生效日窗口: 前后各5个交易日
- 总观察窗口: 11个交易日（中心日+前后各5天）

## 项目文件结构

```
src/窄基调整/窄基前60名/
├── zhaiji_top_indices_list.csv      # 指数列表
├── download_changes.py                # 下载变动数据
├── analyze_performance.py            # 分析股票表现
├── check_api.py                       # API检查
├── filter_narrow_indices.py          # 筛选指数
├── README.md                          # 使用说明
├── CHANGES_SUMMARY.md                 # 修改总结
├── 项目总结.md                        # 本文档
├── run_download.bat                   # 下载批处理
├── run_analysis.bat                   # 分析批处理
└── check_api.bat                      # API检查批处理
```

## 结果分析

根据终端输出，程序已成功运行并生成以下文件：
- ✅ `zhaiji_stocks_performance.csv` - 详细股票表现数据
- ✅ `zhaiji_summary.csv` - 按指数汇总统计

### 可进一步分析的内容

1. **指数效应对比**
   - 不同指数的纳入效应差异
   - 基金规模与纳入效应的关系

2. **时间窗口对比**
   - 数据截止日窗口 vs 生效日窗口的表现差异
   - 最优观察窗口的确定

3. **行业特征**
   - 不同行业股票的纳入效应
   - 热门行业的表现特征

4. **风险分析**
   - 新纳入股票的波动率分析
   - 成交量异常变化检测

## 注意事项

### API要求
1. **下载变动数据**：需要Wind终端启动
2. **分析股票表现**：使用项目数据模块（无需Wind终端）

### 运行时间
- 下载60个指数数据：10-20分钟
- 分析股票表现：取决于股票数量和缓存状态

### 数据存储
- 变动数据文件保存在当前目录
- 股票K线数据使用项目统一的缓存机制
- 建议定期备份数据文件

## 后续优化建议

1. **性能优化**
   - 批量获取股票数据
   - 使用多线程并行处理
   - 优化缓存策略

2. **功能扩展**
   - 增加剔除股票的表现分析
   - 增加更长周期的影响分析
   - 增加指数调整对市场的影响分析

3. **可视化**
   - 生成图表展示分析结果
   - 交互式数据探索界面
   - 自动生成分析报告

## 项目状态

✅ **已完成**
- [x] 指数列表筛选
- [x] 下载程序开发
- [x] 分析程序开发
- [x] API检查工具
- [x] 文档编写
- [x] 数据下载测试
- [x] 分析功能测试

📊 **运行结果**
- 程序成功运行
- 生成完整的结果文件
- 数据格式正确

## 联系方式

如有问题或建议，请参考：
- `README.md` - 详细使用说明
- `CHANGES_SUMMARY.md` - 修改记录
- 终端输出 - 运行时详细信息

