# 中证全指指数成分股获取

## 项目概述

本项目用于获取中证全指指数的全部成分股作为初始股票池，保证覆盖沪深市场绝大部分A股。

## 目标

- **数据源**: 中证全指指数 (000985.CSI)
- **覆盖范围**: 沪深市场绝大部分A股
- **数据获取方式**: 使用Wind API获取

## 数据过滤规则

根据用户要求，程序会自动过滤以下类型的股票：

1. **ST股票**: 剔除包含"ST"、"退"字样的股票
2. **已摘牌股票**: 剔除已经摘牌的股票
3. **新股**: 剔除上市不足3个月的股票（上市天数 < 90天）

## 使用方法

### 1. 运行程序

```bash
python get_995000_constituents.py
```

### 2. 输出文件

程序会生成一个CSV文件，文件名格式为：
```
中证全指成分股_YYYYMMDD.csv
```

例如：`中证全指成分股_20251024.csv`

### 3. 输出字段

CSV文件包含以下字段：

- **股票代码**: Wind代码格式
- **股票简称**: 股票简称
- **上市日期**: 股票上市日期
- **上市板**: 上市板块（主板、创业板、科创板等）
- **上市天数**: 自上市以来的天数

## 程序结构

### 模块化设计
程序采用模块化设计，主要包含以下文件：

1. **`get_995000_constituents.py`** - 主程序
   - `get_csi_all_index_constituents()` - 主函数
   - `filter_stocks()` - 股票过滤函数
   - `save_results()` - 结果保存函数
   - `show_statistics()` - 统计信息显示函数

2. **`wind_api_utils.py`** - Wind API工具库
   - `init_wind_api()` - 初始化Wind API
   - `close_wind_api()` - 关闭Wind API
   - `get_index_constituents()` - 获取指数成分股（周级缓存）
   - `get_stock_basic_info()` - 获取股票基本信息（周级缓存）
   - `get_stock_quotes()` - 获取股票行情数据（使用迅投XTQuant接口）
   - `get_realtime_quotes()` - 获取实时行情数据（使用迅投XTQuant接口）
   - `get_tick_data()` - 获取tick数据（使用迅投XTQuant接口）
   - `get_stock_history_quotes()` - 获取历史行情数据（使用迅投XTQuant接口）
   - `get_batch_stock_history_quotes()` - 批量获取历史行情数据（使用迅投XTQuant接口）
   - `test_wind_connection()` - 测试Wind API连接

3. **`test_api.py`** - 测试脚本
   - `test_wind_api()` - 测试Wind API功能

## 程序功能详解

### 1. 获取成分股
使用 `get_index_constituents()` 函数获取指数成分股，支持指定日期
- **缓存策略**: 周级缓存，相同参数一周内直接返回缓存结果
- **适用场景**: 指数成分股变化不频繁，适合缓存

### 2. 获取股票信息
使用 `get_stock_basic_info()` 函数批量获取股票基本信息，包括：
- 证券简称 (sec_name)
- 上市日期 (ipo_date)
- 摘牌日期 (delist_date)
- 证券存续状态 (sec_status)
- 上市板 (mkt)
- **缓存策略**: 周级缓存，相同参数一周内直接返回缓存结果
- **适用场景**: 股票基本信息变化不频繁，适合缓存

### 3. 数据过滤
使用 `filter_stocks()` 函数按照过滤规则逐步过滤：
1. 剔除已摘牌股票
2. 剔除ST股票
3. 剔除上市不足3个月的股票

### 4. 历史行情数据获取
使用迅投XTQuant接口获取历史行情数据：
- `get_stock_history_quotes()` - 获取单只股票历史数据
- `get_batch_stock_history_quotes()` - 批量获取多只股票历史数据
- 支持前复权、后复权、不复权选项
- 自动从缓存读取，提高效率

### 5. 统计信息
使用 `show_statistics()` 函数显示：
- 最终股票数量
- 按上市板分布统计
- 按上市天数分布统计
- 前20只股票预览

## 依赖环境

- Python 3.x
- Wind API
- 迅投XTQuant数据接口（用于历史行情数据）
- pandas库
- shelveTool缓存模块（用于周级缓存）

## 注意事项

1. **API限制**: 程序使用 `time.sleep(0.5)` 避免Wind API请求过于频繁
2. **分批处理**: 由于一次请求股票数量可能较大，程序采用分批获取的方式（每批50只）
3. **数据更新**: 成分股数据基于当前交易日，如需历史数据需要调整参数
4. **网络连接**: 确保网络畅通，Wind API可以正常访问
5. **缓存机制**: 
   - `get_index_constituents()` 和 `get_stock_basic_info()` 使用周级缓存
   - 相同参数一周内直接返回缓存结果，提高效率
   - 缓存文件存储在shelveTool配置的目录中
6. **数据接口选择**:
   - Wind API: 用于获取指数成分股和股票基本信息
   - 迅投XTQuant: 用于获取历史行情数据、实时行情和tick数据

## 指数代码说明

- **中证全指指数**: 000985.CSI

如果使用其他指数，可以修改代码中的 `index_code` 变量。

## 示例输出

```
================================================================================
获取中证全指指数成分股
================================================================================

1. 初始化Wind API...
✓ Wind API 初始化成功

2. 获取指数: 000985.CSI (中证全指指数)
   正在获取当前成分股...
   ✓ 获取到 5200 只成分股

3. 获取股票基本信息以进行过滤...
   正在处理第 1 批 (50 只股票)...
   ...
   ✓ 获取到 5200 只股票的基本信息

4. 过滤不合格股票...
   原始股票数: 5200
   剔除摘牌股票后: 5100 只
   剔除ST股票后: 4800 只
   剔除上市不足3个月的股票后: 4650 只

5. 保存结果...
   ✓ 数据已保存到: 中证全指成分股_20251024.csv

6. 统计信息:
   最终股票数量: 4650
   
   按上市板分布:
   主板     2800
   创业板   1200
   科创板    650

7. 关闭Wind API...
✓ Wind API 已关闭

================================================================================
处理完成！
================================================================================

✓ 成功获取并过滤 4650 只成分股
```

## 后续使用建议

1. **数据验证**: 建议对获取的数据进行抽样检查，确保过滤逻辑正确
2. **定期更新**: 指数成分股会定期调整，建议每季度更新一次数据
3. **数据分析**: 可以将获取的成分股作为基础股票池进行进一步分析

## 技术支持

如遇到问题，请检查：
1. Wind API是否正确安装和初始化
2. 网络连接是否正常
3. Wind数据权限是否充足

