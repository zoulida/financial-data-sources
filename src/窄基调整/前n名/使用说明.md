# 批量指数成分股变动分析 - 使用说明

## 快速开始

### 最简单的使用方式
```bash
cd "D:\pythonProject\数据源\src\窄基调整\前n名"
python full_analysis.py
```

或者双击运行 `run.bat`

## 程序说明

### 1. full_analysis.py（推荐）
**完整流程脚本**，一键完成所有操作：
- 读取目标指数列表（前20名，排除港股通）
- 批量下载成分股变动数据
- 跳过已下载的数据
- 显示进度和结果统计

### 2. batch_analyze.py
**完整分析脚本**，包含：
- 下载变动数据
- 计算数据截止日
- 分析新纳入股票表现
- 生成详细报告和汇总统计

### 3. quick_analyze.py
**快速分析单个指数**
```bash
python quick_analyze.py 930713.CSI CS人工智能
```

### 4. check_progress.py
**检查当前进度**
```bash
python check_progress.py
```

### 5. filter_indices.py
**筛选指数列表**
- 从指数基金规模数据中筛选前N名
- 自动排除港股通指数

## 输出文件说明

### 变动数据文件
- 格式：`{指数名称}_{指数代码}_changes.csv`
- 包含字段：股票代码、名称、变动类型、日期、权重、涨跌幅等
- 示例：`沪深300_000300.SH_changes.csv`

### 分析结果文件
- `all_indices_newly_included_analysis.csv` - 所有新纳入股票分析结果
- `indices_summary_report.csv` - 按指数统计的汇总报告

## 进度查看

当前已下载2个指数的数据：
- ✅ 沪深300 (000300.SH) - 122条变动记录
- ✅ 中证A500 (000510.SH) - 326条变动记录
- ⏳ 剩余18个指数待下载

运行以下命令查看最新进度：
```bash
python check_progress.py
```

## 数据说明

### 时间范围
- 开始日期：2023-01-01
- 结束日期：当前日期

### 数据截止日计算规则
根据指数调整规则：
- **数据截止日** = 生效日前第二个自然月的最后一个自然日
- **观察窗口** = 数据截止日前后各5个交易日（共11个交易日）

### 分析指标
- 涨跌幅和累计涨跌幅
- 成交量变化率
- 胜率（上涨天数占比）
- 最大/最小涨跌幅
- 波动率

## 注意事项

1. **API配置**：需要先配置Wind API
2. **运行时间**：批量分析20个指数预计需要30-60分钟
3. **数据覆盖**：已下载的数据不会重复下载
4. **网络稳定**：建议在网络稳定的环境下运行

## 常见问题

### Q1: 如何调整分析的指数数量？
A: 修改 `filter_indices.py` 中的参数：
```python
filter_top_indices(20)  # 改为你想要的数量
```

### Q2: 如何修改时间范围？
A: 在 `full_analysis.py` 或 `batch_analyze.py` 中修改：
```python
start_date = "2023-01-01"  # 修改开始日期
end_date = "2024-12-31"     # 修改结束日期
```

### Q3: 数据下载失败怎么办？
A: 程序会自动记录失败的指数，可以重新运行，已成功下载的数据不会重复下载。

## 技术特点

- ✅ **智能跳过**：已下载的数据自动跳过
- ✅ **进度显示**：实时显示下载进度
- ✅ **错误处理**：自动处理API错误
- ✅ **结果保存**：每个指数的数据单独保存
- ✅ **批量处理**：支持多个指数批量分析

## 下一步

1. **继续下载**：运行 `full_analysis.py` 完成剩余18个指数
2. **查看结果**：查看已生成的CSV文件
3. **生成报告**：分析数据并生成统计报告
