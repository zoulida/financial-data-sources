# 真实数据分析说明

## 数据来源

根据您的要求，我已修复程序使用真实的股票数据进行分析：

### 1. 优先使用项目数据模块
```python
from source.实盘.xuntou.datadownload.合并下载数据 import getDayData, batchDownloadDayData
```

使用 `getDayData()` 函数获取真实的股票日线数据：
- 支持从CSV缓存读取（`is_download=0`）
- 支持自动下载（`is_download=1`）
- 使用前复权数据（`dividend_type='front'`）

### 2. 备用方案
- **XtQuant API**：如果项目模块不可用，使用XtQuant的 `get_market_data_ex()`
- **Wind API**：最后备选方案

## 关键修改

### 修复前的问题
1. 使用了模拟数据（`np.random.normal()`），导致结果不真实
2. API调用失败，出现 `NameError: name 'USE_WIND' is not defined`
3. 数据源配置不正确

### 修复后的改进
1. ✅ 使用真实的 `getDayData()` 获取股票数据
2. ✅ 完善了API检查和错误处理
3. ✅ 添加了多个数据源备选方案
4. ✅ 添加了详细的进度输出

## 分析流程

### 1. 计算关键日期
- **数据截止日** = 生效日前第二个自然月的最后一个自然日
- **观察窗口** = 中心日期前后各5个交易日

### 2. 获取真实股票数据
```python
df = getDayData(
    stock_code=stock_code,
    start_date='20240423',  # YYYYMMDD格式
    end_date='20240507',
    is_download=0,  # 从缓存读取
    dividend_type='front'  # 前复权
)
```

### 3. 计算表现指标
- 每日涨跌幅：`pct_change = (close / close.shift(1) - 1) * 100`
- 累计涨跌幅：`(close[-1] / close[0] - 1) * 100`
- 胜率：上涨天数占总天数比例
- 成交量变化率：最后一天成交量相对于平均值的变化

## 预期输出

分析完成后将生成：
- **all_stocks_performance_detail.csv** - 每只股票的详细表现数据
- **汇总统计报告** - 包含：
  - 数据截止日窗口：N只股票，平均累计涨跌幅X%，平均胜率Y%
  - 生效日窗口：N只股票，平均累计涨跌幅X%，平均胜率Y%

## 注意事项

1. **数据获取**：程序会先从CSV缓存读取，如果没有数据会自动下载
2. **网络稳定**：首次运行时需要下载数据，需要稳定网络连接
3. **时间较长**：获取真实数据需要较长时间（预计1-2小时）
4. **数据完整性**：会自动检查数据完整性，确保所有日期都有数据

## 运行说明

```bash
cd "D:\pythonProject\数据源\src\窄基调整\前n名"
python complete_analysis.py
```

程序正在后台运行，获取真实的股票数据并进行分析。
