# ç¼“å­˜åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“¦ æ¦‚è¿°

æœ¬ç³»ç»Ÿé›†æˆäº† `shelve_tool` ç¼“å­˜æ¨¡å—ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ•°æ®è·å–æ•ˆç‡ã€‚é¦–æ¬¡è¿è¡Œéœ€è¦10-30åˆ†é’Ÿï¼Œåç»­è¿è¡Œï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰åªéœ€1-2åˆ†é’Ÿã€‚

## ğŸ¯ ç¼“å­˜ç­–ç•¥

### æŒ‰å¤©ç¼“å­˜ï¼ˆ`@shelve_me_today`ï¼‰

ä»¥ä¸‹å‡½æ•°ä½¿ç”¨**æŒ‰å¤©ç¼“å­˜**ç­–ç•¥ï¼ˆæ¯å¤©æ›´æ–°ä¸€æ¬¡ï¼‰ï¼š

| æ¨¡å— | å‡½æ•° | è¯´æ˜ | ç¼“å­˜åŸå›  |
|------|------|------|----------|
| `wind_data_fetcher.py` | `get_main_board_stocks()` | è·å–ä¸»æ¿Aè‚¡åˆ—è¡¨ | è‚¡ç¥¨åˆ—è¡¨æ¯å¤©å˜åŒ–ä¸å¤§ |
| `wind_data_fetcher.py` | `get_dividend_data()` | è·å–åˆ†çº¢æ•°æ® | åˆ†çº¢æ•°æ®æ¯å­£åº¦æ›´æ–° |
| `wind_data_fetcher.py` | `get_financial_data()` | è·å–è´¢åŠ¡æ•°æ® | è´¢åŠ¡æ•°æ®æ¯å­£åº¦æ›´æ–° |
| `wind_data_fetcher.py` | `get_multi_year_payout_ratio()` | è·å–å¤šå¹´æ”¯ä»˜ç‡ | å†å²æ•°æ®ä¸ä¼šæ”¹å˜ |
| `market_data_fetcher.py` | `calculate_volatility()` | è®¡ç®—æ³¢åŠ¨ç‡ | åŸºäºå†å²è¡Œæƒ…è®¡ç®— |

## ğŸš€ ä½¿ç”¨æ•ˆæœ

### é¦–æ¬¡è¿è¡Œ
```
ç¬¬ä¸€æ­¥: æ„å»ºé€‰è‚¡å®‡å®™
â—‹ è®¡ç®—æ–°æ•°æ®: get_main_board_stocks
æ­£åœ¨è·å–æ²ªæ·±ä¸»æ¿Aè‚¡åˆ—è¡¨...
è·å–åˆ° 3,500 åªä¸»æ¿Aè‚¡

ç¬¬äºŒæ­¥: è·å–æ•°æ®
â—‹ è®¡ç®—æ–°æ•°æ®: get_dividend_data
æ­£åœ¨è·å–åˆ†çº¢æ•°æ®...
[è¿›åº¦æ¡] 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7/7 [00:02:30<00:00]
æˆåŠŸè·å– 3,500 åªè‚¡ç¥¨çš„åˆ†çº¢æ•°æ®

â—‹ è®¡ç®—æ–°æ•°æ®: get_financial_data
...

æ€»è€—æ—¶: çº¦ 15-30 åˆ†é’Ÿ
```

### ç¬¬äºŒæ¬¡è¿è¡Œï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
```
ç¬¬ä¸€æ­¥: æ„å»ºé€‰è‚¡å®‡å®™
âœ“ ä½¿ç”¨ç¼“å­˜æ•°æ®(today): get_main_board_stocks
åˆå§‹è‚¡ç¥¨æ± : 3,500 åª

ç¬¬äºŒæ­¥: è·å–æ•°æ®
âœ“ ä½¿ç”¨ç¼“å­˜æ•°æ®(today): get_dividend_data
âœ“ ä½¿ç”¨ç¼“å­˜æ•°æ®(today): get_financial_data
âœ“ ä½¿ç”¨ç¼“å­˜æ•°æ®(today): get_financial_data
âœ“ ä½¿ç”¨ç¼“å­˜æ•°æ®(today): calculate_volatility

æ€»è€—æ—¶: çº¦ 1-2 åˆ†é’Ÿ
```

## ğŸ“‚ ç¼“å­˜æ–‡ä»¶ä½ç½®

```
æ•°æ®æº/
â””â”€â”€ cache/
    â”œâ”€â”€ shelve.bak
    â”œâ”€â”€ shelve.dat
    â””â”€â”€ shelve.dir
```

## ğŸ”§ ç¼“å­˜ç®¡ç†

### æŸ¥çœ‹ç¼“å­˜ä¿¡æ¯

```python
from src.common.shelve_tool import get_cache_info

info = get_cache_info()
print(f"ç¼“å­˜ç›®å½•: {info['cache_dir']}")
print(f"ç¼“å­˜é”®æ•°: {info['total_keys']}")
print(f"ç¼“å­˜å¤§å°: {info['total_size_mb']:.2f} MB")
```

### æ¸…ç©ºç¼“å­˜

```python
from src.common.shelve_tool import clear_cache

# æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
clear_cache()
```

**æˆ–è€…æ‰‹åŠ¨åˆ é™¤ç¼“å­˜æ–‡ä»¶ï¼š**
```bash
# Windows
del /Q cache\shelve.*

# Linux/Mac
rm cache/shelve.*
```

### å¼ºåˆ¶æ›´æ–°æ•°æ®

å¦‚æœéœ€è¦å¼ºåˆ¶è·å–æœ€æ–°æ•°æ®ï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š

**æ–¹æ³•1: æ¸…ç©ºç¼“å­˜åè¿è¡Œ**
```bash
# åˆ é™¤ç¼“å­˜æ–‡ä»¶
del cache\shelve.*

# è¿è¡Œç¨‹åº
python main.py
```

**æ–¹æ³•2: ç­‰å¾…ç¬¬äºŒå¤©è‡ªåŠ¨æ›´æ–°**
- æŒ‰å¤©ç¼“å­˜ä¼šåœ¨ç¬¬äºŒå¤©è‡ªåŠ¨å¤±æ•ˆ
- ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ

## ğŸ“Š ç¼“å­˜é”®ç”Ÿæˆè§„åˆ™

ç¼“å­˜é”®æ ¼å¼ï¼š
```
å‡½æ•°å_å‚æ•°1_å‚æ•°2_æ—¶é—´åç¼€
```

ç¤ºä¾‹ï¼š
```
get_main_board_stocks_20241031
get_dividend_data_['000001.SZ', '000002.SZ']_20241031
calculate_volatility_['600519.SH']_252_20241031
```

## âš™ï¸ é«˜çº§é…ç½®

### ä¿®æ”¹ç¼“å­˜è·¯å¾„

ç¼–è¾‘ `src/common/shelve_tool.py`ï¼š

```python
# ä¿®æ”¹è¿™ä¸€è¡Œ
SHELVE_DIR = Path(__file__).resolve().parents[2] / "cache"

# æ”¹ä¸ºè‡ªå®šä¹‰è·¯å¾„
SHELVE_DIR = Path("D:/my_cache")
```

### è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥

å¦‚æœéœ€è¦ä¸åŒçš„ç¼“å­˜å‘¨æœŸï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–è£…é¥°å™¨ï¼š

```python
from src.common.shelve_tool import shelve_me, shelve_me_hour, shelve_me_week

# æ°¸ä¹…ç¼“å­˜ï¼ˆä¸è¿‡æœŸï¼‰
@shelve_me
def my_function():
    pass

# æŒ‰å°æ—¶ç¼“å­˜
@shelve_me_hour
def my_function():
    pass

# æŒ‰å‘¨ç¼“å­˜
@shelve_me_week
def my_function():
    pass
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç¼“å­˜ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**: æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—ï¼Œä¸ä½¿ç”¨ç¼“å­˜

**å¯èƒ½åŸå› **:
1. å‚æ•°ä¸åŒï¼ˆåˆ—è¡¨é¡ºåºå˜åŒ–ä¹Ÿä¼šå¯¼è‡´ç¼“å­˜é”®ä¸åŒï¼‰
2. å‡½æ•°å†…éƒ¨æŠ›å‡ºå¼‚å¸¸ï¼ˆå¤±è´¥çš„è°ƒç”¨ä¸ä¼šè¢«ç¼“å­˜ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å‚æ•°ä¸€è‡´
- æ£€æŸ¥å‡½æ•°æ˜¯å¦æ‰§è¡ŒæˆåŠŸ

### é—®é¢˜2: æ•°æ®è¿‡æœŸä½†ä»ä½¿ç”¨ç¼“å­˜

**ç—‡çŠ¶**: ä½¿ç”¨äº†æ˜¨å¤©çš„ç¼“å­˜æ•°æ®

**åŸå› **: ç³»ç»Ÿæ—¶é—´ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç³»ç»Ÿæ—¶é—´
- æ‰‹åŠ¨æ¸…ç©ºç¼“å­˜

### é—®é¢˜3: ç¼“å­˜æ–‡ä»¶è¿‡å¤§

**ç—‡çŠ¶**: cache ç›®å½•å ç”¨ç©ºé—´è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**:
```python
from src.common.shelve_tool import list_cache_keys, clear_cache

# æŸ¥çœ‹æ‰€æœ‰ç¼“å­˜é”®
keys = list_cache_keys()
print(f"å…±æœ‰ {len(keys)} ä¸ªç¼“å­˜æ¡ç›®")

# æ¸…ç©ºç¼“å­˜
clear_cache()
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¼€å‘é˜¶æ®µ
- é¢‘ç¹ä¿®æ”¹ä»£ç æ—¶ï¼Œå»ºè®®æ¸…ç©ºç¼“å­˜æµ‹è¯•
- ä½¿ç”¨å°æ•°æ®é›†æµ‹è¯•

### 2. ç”Ÿäº§ä½¿ç”¨
- ä¿æŒç¼“å­˜ä»¥æé«˜æ•ˆç‡
- æ¯å¤©é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨æ›´æ–°æ•°æ®

### 3. æ•°æ®æ›´æ–°
- **æ—¥å¸¸è¿è¡Œ**: ä½¿ç”¨ç¼“å­˜å³å¯
- **è´¢æŠ¥å­£**: å»ºè®®æ¸…ç©ºç¼“å­˜è·å–æœ€æ–°æ•°æ®
- **ç´§æ€¥æ›´æ–°**: æ‰‹åŠ¨åˆ é™¤ç¼“å­˜æ–‡ä»¶

### 4. æ€§èƒ½ä¼˜åŒ–
- ç¼“å­˜å¯ä»¥èŠ‚çœ 90%+ çš„è¿è¡Œæ—¶é—´
- é€‚åˆæ‰¹é‡æµ‹è¯•ä¸åŒå‚æ•°é…ç½®

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|--------|--------|------|
| é¦–æ¬¡è¿è¡Œ | 15-30åˆ†é’Ÿ | 15-30åˆ†é’Ÿ | - |
| ç¬¬äºŒæ¬¡è¿è¡Œ | 15-30åˆ†é’Ÿ | 1-2åˆ†é’Ÿ | **93%** â†“ |
| è°ƒæ•´å‚æ•°é‡è·‘ | 15-30åˆ†é’Ÿ | 1-2åˆ†é’Ÿ | **93%** â†“ |
| ç¬¬äºŒå¤©è¿è¡Œ | 15-30åˆ†é’Ÿ | 15-30åˆ†é’Ÿ | - (è‡ªåŠ¨æ›´æ–°) |

## ğŸ“ ç¼“å­˜åŸç†

1. **é¦–æ¬¡è°ƒç”¨**: æ‰§è¡Œå‡½æ•° â†’ ä¿å­˜ç»“æœåˆ° shelve
2. **å†æ¬¡è°ƒç”¨**: æ£€æŸ¥ç¼“å­˜ â†’ è¿”å›ç¼“å­˜ç»“æœ
3. **è¿‡æœŸæ£€æŸ¥**: åŸºäºæ—¶é—´åç¼€è‡ªåŠ¨åˆ¤æ–­

**æ—¶é—´åç¼€ç¤ºä¾‹**:
- æŒ‰å¤©: `20241031`
- æŒ‰å°æ—¶: `20241031_14`
- æŒ‰å‘¨: `2024_W44`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ç¼“å­˜ç›¸å…³é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `src/common/shelve_tool.py` - æºä»£ç 
- `md/çŸ¥è¯†åº“/shelveTool_documentation.md` - è¯¦ç»†æ–‡æ¡£

---

**æç¤º**: ç¼“å­˜åŠŸèƒ½å·²è‡ªåŠ¨é›†æˆï¼Œæ— éœ€é¢å¤–é…ç½®å³å¯ä½¿ç”¨ï¼

