# A股情绪周期日线打分系统

## 📋 概述

本系统是一个基于6个硬指标的A股市场情绪周期日线打分工具，通过量化分析市场情绪，为投资决策提供参考。

## 🎯 核心功能

- **6个硬指标评分**：成交量、涨跌停、波动率、北向资金、涨跌广度、融资余额
- **日线数据获取**：自动从Wind API和xtquant获取实时数据
- **智能评分算法**：基于历史分位数和规则的综合评分
- **情绪状态判断**：7个等级的情绪状态分类
- **数据保存**：每日CSV格式数据保存
- **统计报告**：自动生成统计分析和趋势报告

## 📊 6个硬指标详解

### 1. 成交量 (15%权重)
- **数据源**：Wind全A指数成交总额
- **评分规则**：250日滚动分位，前20%→80-100分，后20%→0-40分，中段→40-80分
- **意义**：反映市场活跃度和资金参与度

### 2. 涨跌停 (20%权重)
- **数据源**：Wind内地涨跌家数统计
- **评分规则**：
  - 涨停≥50且跌停=0 → 100分
  - 跌停≥30且涨停<20 → 0分
  - 其余 → 40-80分线性插值
- **意义**：反映市场极端情绪和资金偏好

### 3. 波动率 (10%权重)
- **数据源**：xtquant沪深300指数20日历史波动率
- **评分规则**：250日分位，高波动→0-40分，低波动→80-100分
- **意义**：反映市场风险水平和不确定性

### 4. 北向资金 (10%权重)
- **数据源**：Wind 710001.WI净买入额
- **评分规则**：
  - 连续5日净流入且总量>50亿 → 100分
  - 连续5日净流出且总量>50亿 → 0分
  - 其余 → 40-80分线性插值
- **意义**：反映外资对A股的信心和偏好

### 5. 涨跌广度 (15%权重)
- **数据源**：Wind内地涨跌家数统计
- **评分规则**：基于上涨家数/下跌家数比值
- **额外规则**：指数红但比值<0.7额外-10分，指数绿但比值>1.5额外+10分
- **意义**：反映市场整体涨跌分布和广度

### 6. 融资余额 (10%权重)
- **数据源**：Wind融资余额数据
- **评分规则**：250日分位，大增→80-100分，大减→0-40分，中段→40-80分
- **意义**：反映杠杆资金的风险偏好

## 🚀 使用方法

### 基本使用

```python
from src.市场情绪.a_stock_emotion_scorer import A股情绪周期打分器

# 创建打分器
打分器 = A股情绪周期打分器()

# 运行每日打分（最近30天）
结果数据 = 打分器.运行每日打分()

# 打印最新结果
打分器.打印最新结果(结果数据)

# 保存结果
文件路径 = 打分器.保存结果(结果数据)

# 关闭资源
打分器.关闭()
```

### 指定日期范围

```python
# 指定开始和结束日期
结果数据 = 打分器.运行每日打分('2025-01-01', '2025-01-31')
```

### 生成统计报告

```python
# 生成统计报告
统计报告 = 打分器.生成统计报告(结果数据)
print(统计报告)
```

## 📈 输出格式

### CSV文件格式
```csv
日期,成交量得分,涨跌停得分,波动率得分,北向资金得分,涨跌广度得分,融资余额得分,综合得分,情绪状态
2025-10-29,50.00,73.68,50.00,100.00,61.88,50.00,61.11,偏乐观
```

### 情绪状态等级
- **极度乐观**：综合得分 ≥ 80
- **乐观**：综合得分 70-79
- **偏乐观**：综合得分 60-69
- **中性**：综合得分 50-59
- **偏悲观**：综合得分 40-49
- **悲观**：综合得分 30-39
- **极度悲观**：综合得分 < 30

## 🔧 配置说明

### 数据源配置
- **Wind API**：需要安装WindPy并配置数据权限
- **xtquant**：需要安装xtquant并配置xttrader
- **模拟数据**：当数据源不可用时自动使用模拟数据

### 权重配置
当前权重配置（可调整）：
- 成交量：15%
- 涨跌停：20%
- 波动率：10%
- 北向资金：10%
- 涨跌广度：15%
- 融资余额：10%
- 预留：20%

## 📁 文件结构

```
src/市场情绪/
├── a_stock_emotion_scorer.py    # 主程序
├── data_fetcher.py              # 数据获取模块
├── score_calculator.py          # 评分计算模块
├── README_A股情绪打分.md        # 说明文档
└── logs/                        # 日志文件
    └── a_stock_emotion_scorer_*.log
```

## 📊 输出文件

### 数据文件
- **位置**：`data/a_stock_emotion_daily_score_*.csv`
- **内容**：每日情绪得分数据
- **更新**：每次运行生成新文件

### 日志文件
- **位置**：`logs/a_stock_emotion_scorer_*.log`
- **内容**：程序运行日志和错误信息
- **更新**：每日生成新日志文件

## ⚠️ 注意事项

### 数据获取
1. **Wind API权限**：确保有相应的数据权限
2. **xtquant配置**：确保xttrader正常运行
3. **网络连接**：需要稳定的网络连接
4. **数据延迟**：部分数据可能有1-2天延迟

### 评分算法
1. **历史数据依赖**：需要足够的历史数据计算分位数
2. **权重调整**：可根据市场情况调整权重配置
3. **规则优化**：评分规则可根据实际效果进行优化

### 使用建议
1. **定期运行**：建议每日收盘后运行
2. **数据验证**：定期检查数据获取的准确性
3. **结果分析**：结合其他指标综合分析
4. **风险提示**：仅供参考，不构成投资建议

## 🔍 故障排除

### 常见问题
1. **数据获取失败**：检查数据源配置和权限
2. **评分异常**：检查历史数据是否充足
3. **程序报错**：查看日志文件获取详细错误信息

### 调试模式
```python
# 启用详细日志
打分器 = A股情绪周期打分器(log_level=logging.DEBUG)
```

## 📞 技术支持

如遇到问题，请检查：
1. 数据源配置是否正确
2. 网络连接是否正常
3. 日志文件中的错误信息
4. 历史数据是否充足

## 📝 更新日志

### v1.0.0 (2025-01-29)
- 初始版本发布
- 支持6个硬指标评分
- 集成Wind API和xtquant数据源
- 提供完整的情绪状态判断
- 支持数据保存和统计报告

---

**免责声明**：本系统仅供参考，不构成投资建议。投资有风险，入市需谨慎。
