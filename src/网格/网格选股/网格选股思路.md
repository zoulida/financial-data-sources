我有 1800 只国内标的（csv 含 code, name 两列），需要批量计算 70%Vol + 30%HL 的网格综合打分并降序排序。
要求：
用 合并  拉取 2024-01-01 至今的后复权日线，缺失数据自动丢弃。
VolScore：30 日年化波动率→ (hist30-10)/0.4 钳位 0-100。
HLScore：用 252 日对数价做 OLS 离散回归求 β，β<0 时 HL=ln(2)/(-β)，再与自身过去 252 日 HL 滚动分位比较得 0-100 分；β≥0 则 HLScore=0。
Total = 0.7VolScore + 0.3HLScore。
1、其中，volscore如下方式打分：
① 历史波动率得分（0–100）
VolScore = min(100, max(0, (HistVol - 10) / 0.4))
HistVol = 30 日收盘-收盘年化波动率（%）
10% 映射 0 分，50% 映射 100 分，线性插值；<10% 一律 0 分，>50% 一律 100 分。
② 波动稳定性得分（0–100）
用“跳空+日内真实波幅”综合：
复制
GapRatio = mean(|开盘涨跌幅|) / mean(ATR/前收)
StabScore = 100 * (1 - GapRatio) * (1 - skewness(日收益))
GapRatio >0.5 视为跳空魔鬼，直接 0 分；
skewness 取 252 日，左偏（<–0.5）或右偏（>0.5）都扣分；
最终把结果线性映射 0–100。
③ 近期波动衰减得分（0–100）
DecayScore = 100 * (HistVol30 / HistVol252)
比值 ≥1 得 100（没衰减），≤0.3 得 0（衰减厉害），线性插值。
三、合成总分
Total = 0.4*VolScore + 0.35*StabScore + 0.25*DecayScore
意义：| 维度           | 权重  | 目的              |
| ------------ | --- | --------------- |
| 1. 历史波动率高低   | 40% | 够不够“肥”，肥了才有网格利润 |
| 2. 波动稳定性/规律性 | 35% | 拒绝极端跳空，拒绝单边     |
| 3. 近期波动衰减    | 25% | 防止“过去很肥、现在萎了”   |

2、HLScore打分用如下方法：
一、计算步骤（代码级）
取 252 个交易日对数价序列 ln(P)。
做 OLS 离散回归
Δy_t = α + β·y_{t-1} + ε_t
其中 y_t = ln(P_t)，Δy_t = y_t – y_{t-1}。
得 β 后算 HL（日历日）：
θ = –ln(1+β)
HL = ln(2)/θ （当 β<0，否则 HL→∞，直接给 0 分）
对同一标的 滚动 63 天重复 2-3，得到 HL 序列（长度=252-63+1=190 个点）。
二、打分公式（0–100）
用 自身历史分位 + 跨品种相对分位 双基准：
复制
a) 自身分位 = 1 – percentile(HL_current, HL_history)
   （HL 越小越好，所以用“1-分位”）

b) 跨品种分位 = 1 – percentile(HL_current, 全市场HL)

Score = 0.6*a + 0.4*b


最后 ：结果导出 result.csv：列名 = [code, name, hist30, hl, VolScore, HLScore, Total]，按 Total 降序。
异步协程加速，进度条 tqdm，异常捕获不中断。
完整单文件 Python，pip install 仅需 pandas numpy statsmodels tqdm。