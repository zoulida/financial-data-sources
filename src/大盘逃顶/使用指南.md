# A股逃顶打分器使用指南

## 快速开始

### 1. 安装依赖

```bash
# 进入项目目录
cd src/大盘逃顶

# 安装必需的Python包
pip install -r requirements.txt

# 或者直接安装
pip install pandas numpy matplotlib requests beautifulsoup4 akshare
```

### 2. 运行程序

#### Windows用户
双击 `run.bat` 文件即可运行

或在命令行运行：
```bash
python escape_top_scorer.py
```

#### Linux/Mac用户
```bash
chmod +x run.sh
./run.sh
```

### 3. 查看结果

程序运行后会：
1. 在终端显示当日评分结果
2. 保存历史数据到 `escape_top_history.csv`
3. 生成趋势图 `escape_top_chart.png`

## 进阶配置

### 配置数据源Token

如果你有Wind终端或XtQuant账号，可以配置以获得更准确的数据：

1. 复制 `config_example.py` 为 `config.py`
```bash
cp config_example.py config.py
```

2. 编辑 `config.py`，填入你的配置信息

### 测试数据源

运行测试脚本检查各个数据源是否可用：
```bash
python test_data_sources.py
```

这会测试：
- Wind API 是否可用
- XtQuant 是否可用
- akshare 是否可用
- 东方财富网API 是否可用

## 定时自动运行

### Windows 任务计划

1. 打开"任务计划程序" (taskschd.msc)
2. 点击"创建基本任务"
3. 设置任务名称："A股逃顶打分器"
4. 触发器：每日 15:30 运行
5. 操作：启动程序
   - 程序/脚本：完整路径到 `python.exe`
   - 参数：`escape_top_scorer.py`
   - 起始于：`D:\pythonProject\数据源\src\大盘逃顶`

### Linux/Mac Crontab

编辑 crontab：
```bash
crontab -e
```

添加以下行（交易日15:30运行）：
```bash
30 15 * * 1-5 cd /path/to/数据源/src/大盘逃顶 && python escape_top_scorer.py >> log.txt 2>&1
```

## 输出文件说明

### escape_top_history.csv
历史评分数据，包含以下字段：
- `date`: 日期
- `financing_score`: 融资余额得分
- `account_score`: 开户数得分
- `divergence_score`: 量价背离得分
- `valuation_score`: 估值百分位得分
- `total_score`: 总分

### escape_top_chart.png
近3个月总分趋势图，包含：
- 蓝色折线：每日总分
- 红色虚线：逃顶警戒线（2.2分）
- 红色星标：强烈逃顶信号的日期

## 常见问题

### Q1: akshare 导入失败或数据获取失败

**解决方法**:
```bash
# 更新到最新版本
pip install --upgrade akshare

# 或重新安装
pip uninstall akshare
pip install akshare
```

### Q2: Wind API 无法连接

**检查项**:
1. Wind终端是否已启动
2. Wind终端是否已登录
3. WindPy是否正确安装：`pip install WindPy`

### Q3: XtQuant 获取数据失败

**解决方法**:
1. 检查是否设置了token
2. 在 http://dict.thinktrader.net 注册并获取token
3. 在代码中设置：`xtdata.set_token('your_token')`

### Q4: 程序运行但没有数据

**可能原因**:
1. 非交易日运行（周末或节假日）
2. 交易时间段内数据还未更新
3. 网络连接问题

**解决方法**:
- 在交易日收盘后（15:30以后）运行
- 检查网络连接
- 查看详细错误信息

### Q5: 图表中文显示为方块

**解决方法**:
```python
# 在代码中已设置中文字体
plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']

# 如果还是不行，安装中文字体
# Windows: 系统自带
# Linux: sudo apt-get install fonts-wqy-zenhei
# Mac: 系统自带
```

## 数据更新频率

| 指标 | 更新频率 | 最佳查询时间 |
|------|---------|-------------|
| 融资余额 | 每日 | 交易日收盘后 |
| 开户数 | 每月 | 每月初 |
| 量价背离 | 每日 | 交易日收盘后 |
| 估值百分位 | 每日 | 交易日收盘后 |

建议每天15:30后运行，以获取最新的数据。

## 联系与反馈

如有问题或建议，欢迎提交Issue。

## 免责声明

⚠️ 本工具仅供学习和研究使用，不构成任何投资建议。
投资有风险，入市需谨慎。使用本工具产生的任何后果，用户需自行承担责任。

