# 开户数据获取 - 快速开始

## 📁 文件说明

| 文件名 | 说明 | 用途 |
|--------|------|------|
| `README.md` | 项目简介 | 了解模块功能和应用场景 |
| `开户数据API使用说明.md` | 详细API文档 | 查看完整的API说明和示例 |
| `示例代码.py` | 完整示例代码 | 包含所有功能的完整示例 |
| `test_simple.py` | 简单测试脚本 | 快速验证功能是否正常 |
| `run_test.bat` | 测试运行脚本 | 双击运行简单测试 |
| `run_full_example.bat` | 完整示例运行脚本 | 双击运行完整示例 |

---

## 🚀 快速使用

### 方式一：运行批处理文件（推荐）

#### 1. 简单测试
双击运行 `run_test.bat`，查看基本功能是否正常。

#### 2. 完整示例
双击运行 `run_full_example.bat`，执行完整的数据获取、分析和可视化。

### 方式二：命令行运行

```bash
# 激活虚拟环境
.\venv\Scripts\activate

# 简单测试
python src\aksharedir\开户数据\test_simple.py

# 完整示例
python src\aksharedir\开户数据\示例代码.py
```

### 方式三：在代码中使用

```python
import akshare as ak
import pandas as pd

# 获取数据
df = ak.stock_account_statistics_em()

# 查看最近数据
print(df.tail())

# 获取最新一条
latest = df.sort_values('数据日期').iloc[-1]
print(f"最新数据: {latest['数据日期']}")
print(f"新增开户: {latest['新增投资者-数量']} 万户")
```

---

## 📊 输出文件

运行完整示例后，会在以下位置生成文件：

### 数据文件（output/ 目录）
- `开户数据.csv` - CSV格式
- `开户数据.xlsx` - Excel格式
- `开户数据.parquet` - Parquet格式（推荐）

### 图表文件（项目根目录）
- `开户数据_基础图表.png` - 基础图表（新增开户数、上证指数）
- `开户数据_高级图表.png` - 高级图表（移动平均、增长率、双轴对比）

### 缓存文件（cache/ 目录）
- `account_data.parquet` - 数据缓存（24小时有效）

---

## 🔍 功能列表

### 示例代码.py 包含的功能：

1. ✅ **基础数据获取** - 获取全部历史数据
2. ✅ **最新数据查询** - 查看最新一条记录
3. ✅ **数据处理** - 日期转换、排序、索引设置
4. ✅ **衍生指标计算** - 环比、同比、移动平均、分位数
5. ✅ **统计分析** - 均值、中位数、极值、季节性分析
6. ✅ **相关性分析** - 开户数与指数的相关性、滞后相关性
7. ✅ **数据缓存** - 本地缓存机制，减少重复请求
8. ✅ **安全获取** - 异常处理、重试机制
9. ✅ **告警检测** - 开户数过热检测
10. ✅ **数据可视化** - 基础图表、高级图表
11. ✅ **数据导出** - CSV、Excel、Parquet格式

---

## 📌 重要提示

### ⚠️ 数据时效性
- **当前状况**: 该接口最新数据截至 **2023年8月**，后续数据暂未更新
- **数据范围**: 约2016年1月 - 2023年8月（共100+条记录）
- **获取最新数据**: 如需2023年9月之后的数据，请使用替代方案（见下方）

### 数据更新时间（理论）
- 中国结算每月**中旬**（10-15号）公布上月数据
- AKShare 通常在官方公布后 **1-2 天**内同步
- 最新数据为**上个月**的统计

### 获取最新开户数据的替代方案
1. **中国结算官网**: http://www.chinaclear.cn/ （手动下载月报）
2. **Wind数据库**: 使用 Wind API 获取（需要订阅）
3. **同花顺iFinD**: 金融终端数据
4. **东方财富Choice**: 金融终端数据

### 数据字段
```python
'数据日期'              # 统计月份（YYYY-MM）
'新增投资者-数量'       # 当月新增开户数（万户）
'新增投资者-环比'       # 新增数量环比增长率（%）
'新增投资者-同比'       # 新增数量同比增长率（%）
'期末投资者-总量'       # 累计投资者总数（万户）
'期末投资者-A股账户'    # A股账户数量（万户）
'期末投资者-B股账户'    # B股账户数量（万户）
'沪深总市值'            # 沪深两市总市值（亿元）
'沪深户均市值'          # 户均市值（万元）
'上证指数-收盘'         # 该月最后一个交易日收盘价
'上证指数-涨跌幅'       # 该月上证指数涨跌幅（%）
```

### 应用场景
1. **市场情绪分析** - 新增开户数反映散户入市热情
2. **顶底判断** - 开户数激增往往是市场顶部信号
3. **长期趋势** - 期末投资者总量反映市场参与度
4. **配合行情** - 结合上证指数判断市场阶段

---

## 🛠️ 常见问题

### Q1: 运行报错找不到模块？
**A**: 确保已激活虚拟环境并安装了 akshare：
```bash
.\venv\Scripts\activate
pip install akshare
```

### Q2: 数据获取失败？
**A**: 可能原因：
- 网络连接问题
- AKShare 版本过旧（更新：`pip install --upgrade akshare`）
- 数据源临时维护

### Q3: 如何只获取最近一年的数据？
**A**: 获取后进行筛选：
```python
df = ak.stock_account_statistics_em()
df['数据日期'] = pd.to_datetime(df['数据日期'])
df_recent = df[df['数据日期'] >= '2024-01-01']
```

### Q4: 图表中文显示乱码？
**A**: 确保系统安装了中文字体（SimHei 或 Microsoft YaHei），示例代码已包含字体设置。

---

## 📚 相关文档

- [AKShare 官方文档](https://akshare.akfamily.xyz/)
- [中国结算官网](http://www.chinaclear.cn/)
- 详细使用说明: `开户数据API使用说明.md`
- 项目简介: `README.md`

---

## 📞 技术支持

如有问题，请查看：
1. `README.md` - 项目简介和应用场景
2. `开户数据API使用说明.md` - 完整的API文档和常见问题
3. `示例代码.py` - 查看代码注释和实现细节

---

**祝使用愉快！** 🎉

