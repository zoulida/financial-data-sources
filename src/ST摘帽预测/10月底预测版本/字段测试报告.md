# Wind API字段测试报告

## 测试时间
2025-01-20

## 测试结果总结

### ✅ 成功获取的字段

#### 1. 1-3季度累计数据字段（Q3报告期）
- ✅ `np_belongto_parcomsh` - 归属母公司股东的净利润（累计）
- ✅ `deductedprofit_ttm2` - 扣除非经常性损益后归属母公司股东的净利润（TTM）
- ✅ `oper_rev` - 营业收入（累计）
- ✅ `grossprofitmargin` - 销售毛利率
- ✅ `expensetosales` - 销售期间费用率
- ✅ `fin_exp_is` - 财务费用
- ✅ `eqy_belongto_parcomsh` - 归属母公司股东的权益（净资产）
- ✅ `div_aualcashdividend` - 年度现金分红总额（公告）
- ✅ `fa_nrgl` - 非经常性损益

#### 2. Q3单季数据
- ✅ Q3累计营收 (`oper_rev`) - 成功
- ✅ Q2累计营收 (`oper_rev`) - 成功
- 说明：Q3单季营收 = Q3累计 - Q2累计，可以计算

#### 3. 总市值
- ✅ `mkt_cap_ard` - 总市值（推荐使用）
- ✅ `val_mv_ARD` - 总市值（备用字段，但数据可能为None）

#### 4. 其他数据字段
- ✅ `net_cash_flows_oper_act` - 经营活动产生的现金流量净额
- ✅ `riskwarning` - 是否属于风险警示板（可部分替代违规标识）
- ✅ `riskadmonition_date` - 戴帽摘帽时间（可获取ST历史信息）

---

### ❌ 无法获取的字段

#### 1. 审计意见代码
- ❌ `opinion_type` - ErrorCode=-40522006（不支持的指标）
- **查找结果**：在 `merged_fields_fixed.txt` 中只找到：
  - `auditor` - 审计机构（但这不是审计意见代码）
- **建议**：
  - 审计意见代码在Wind API中可能不存在或需要其他接口
  - 可以考虑使用 `auditor`（审计机构）作为参考，但无法直接获取意见类型代码
  - **需要您提供其他数据源或手动维护**

#### 2. 违规立案标识
- ❌ `st_risk` - ErrorCode=-40522006（不支持的指标）
- **查找结果**：在 `merged_fields_fixed.txt` 中未找到相关字段
- **替代方案**：
  - ✅ `riskwarning` - 是否属于风险警示板（可用，但不等同于违规立案）
  - ✅ `riskadmonition_date` - 戴帽摘帽时间（可获取ST历史）
- **建议**：
  - 可以使用 `riskwarning` 作为部分参考，但无法直接获取"违规立案"标识
  - **需要您提供其他数据源或手动维护**

#### 3. 预告披露日
- ❌ `forecast_date` - ErrorCode=-40522006（不支持的指标）
- ❌ `earnings_forecast_date` - ErrorCode=-40522006（不支持的指标）
- ❌ `w.wset("performanceforecast")` - ErrorCode=-40522012（不支持的请求参数）
- **查找结果**：在 `merged_fields_fixed.txt` 中未找到相关字段
- **建议**：
  - 预告披露日可能不在Wind API的标准字段中
  - 可能需要使用Wind终端的数据表或公告数据接口
  - **需要您提供其他数据源或手动维护**

---

## 字段映射建议

### 已确认可用的字段映射

| 需求字段 | Wind字段 | 状态 | 备注 |
|---------|---------|------|------|
| 累计归母净利润 | `np_belongto_parcomsh` | ✅ | 使用rptDate参数 |
| 累计扣非净利润 | `deductedprofit_ttm2` | ✅ | TTM值，非累计值 |
| 累计营业收入 | `oper_rev` | ✅ | 使用rptDate参数 |
| 毛利率 | `grossprofitmargin` | ✅ | 使用rptDate参数 |
| 期间费用率 | `expensetosales` | ✅ | 使用rptDate参数 |
| 财务费用 | `fin_exp_is` | ✅ | 使用rptDate参数 |
| 净资产 | `eqy_belongto_parcomsh` | ✅ | 使用rptDate参数 |
| 分红计划 | `div_aualcashdividend` | ✅ | 年度现金分红总额 |
| 非经常性损益 | `fa_nrgl` | ✅ | 使用rptDate参数 |
| 总市值 | `mkt_cap_ard` | ✅ | 使用tradeDate参数 |
| 经营现金流 | `net_cash_flows_oper_act` | ✅ | 使用rptDate参数 |
| 风险警示板标识 | `riskwarning` | ✅ | 可部分替代违规标识 |

### 需要替代方案的字段

| 需求字段 | 建议方案 | 备注 |
|---------|---------|------|
| 审计意见代码 | 使用默认值或跳过 | Wind API中无此字段，需要其他数据源 |
| 违规立案标识 | 使用 `riskwarning` 或默认值0 | 无法直接获取，`riskwarning`可部分参考 |
| 预告披露日 | 使用None或跳过 | Wind API中无此字段，需要其他数据源 |

---

## 代码修改建议

### 1. 审计意见代码
- 当前代码已使用try-except处理，可以保持
- 如果获取失败，使用默认值（如np.nan）或跳过该项打分

### 2. 违规立案标识
- 可以使用 `riskwarning` 字段作为参考
- 如果 `riskwarning == "是"`，可以认为存在风险（但不是违规立案）
- 或使用默认值0（假设无违规立案）

### 3. 预告披露日
- 当前代码已使用None占位
- 软指标4（预告披露日≤1月31日）暂时跳过，该项得分固定为0

---

## 总结

### 可以正常获取的数据（9/12项）
✅ 所有财务数据字段都可以正常获取
✅ 总市值可以正常获取
✅ 经营现金流可以正常获取
✅ 风险警示板标识可以获取（可部分替代违规标识）

### 无法获取的数据（3项）
❌ **审计意见代码** - Wind API中不存在此字段
❌ **违规立案标识** - Wind API中不存在此字段
❌ **预告披露日** - Wind API中不存在此字段

### 建议
1. **审计意见代码**：需要您提供其他数据源或手动维护
2. **违规立案标识**：可以使用 `riskwarning` 作为部分参考，或需要其他数据源
3. **预告披露日**：需要您提供其他数据源或手动维护

---

## 下一步行动
1. 更新代码，使用可获取的字段
2. 对于无法获取的字段，使用默认值或跳过
3. 等待您提供其他数据源或手动维护方案

