# 无法获取的字段说明

## 测试结果

根据测试，以下字段在Wind API中**无法直接获取**：

### 1. ❌ 审计意见代码 (`opinion_type`)
- **错误码**: -40522006（不支持的指标）
- **查找结果**: 在 `merged_fields_fixed.txt` 中只找到 `auditor`（审计机构），但没有审计意见代码字段
- **建议**: 
  - 需要您提供其他数据源（如从公告中提取）
  - 或手动维护审计意见代码数据
  - 或跳过此项打分（硬门槛5暂时无法实现）

### 2. ❌ 违规立案标识
- **测试字段**: `st_risk` - 错误码: -40522006（不支持的指标）
- **查找结果**: 在 `merged_fields_fixed.txt` 中未找到相关字段
- **替代方案**: 
  - ✅ `riskwarning` - 是否属于风险警示板（可用，但不等同于违规立案）
  - ✅ `riskadmonition_date` - 戴帽摘帽时间（可用）
- **建议**:
  - 可以使用 `riskwarning` 作为部分参考，但无法直接获取"违规立案"标识
  - 违规立案和风险警示板是不同的概念
  - 需要您提供其他数据源或手动维护

### 3. ❌ 预告披露日
- **测试字段**: 
  - `forecast_date` - 错误码: -40522006（不支持的指标）
  - `earnings_forecast_date` - 错误码: -40522006（不支持的指标）
  - `w.wset("performanceforecast")` - 错误码: -40522012（不支持的请求参数）
- **查找结果**: 在 `merged_fields_fixed.txt` 中未找到相关字段
- **建议**:
  - 预告披露日可能不在Wind API的标准字段中
  - 可能需要使用Wind终端的数据表或公告数据接口
  - 需要您提供其他数据源或手动维护
  - 软指标4（预告披露日≤1月31日）暂时无法实现

---

## 影响分析

### 硬门槛得分（6项）
- ✅ 硬门槛1：净利>0 - **可用**
- ✅ 硬门槛2：扣非>0 - **可用**
- ✅ 硬门槛3：营收≥1亿 - **可用**
- ✅ 硬门槛4：净资产>0 - **可用**
- ❌ **硬门槛5：审计意见∈{1,2} - 无法获取，需要其他数据源**
- ❌ **硬门槛6：违规标识=0 - 无法获取，需要其他数据源**

### 软指标得分（4项）
- ✅ 软指标1：经营现金流/营收≥0.7 - **可用**
- ⚠️ 软指标2：毛利率同比>0 - **需要历史数据计算**
- ⚠️ 软指标3：期间费用率同比<0 - **需要历史数据计算**
- ❌ **软指标4：预告披露日≤1月31日 - 无法获取，需要其他数据源**

---

## 当前代码处理方式

### 审计意见代码
- 代码中已使用try-except处理
- 如果获取失败，使用 `np.nan` 作为默认值
- 硬门槛5的打分将无法正常进行（该项得分固定为0）

### 违规立案标识
- 代码中使用默认值0（假设无违规立案）
- 可以使用 `riskwarning` 作为参考，但不等于违规立案
- 硬门槛6的打分将无法正常进行（该项得分固定为1，因为默认值为0）

### 预告披露日
- 代码中使用 `None` 占位
- 软指标4的打分将无法正常进行（该项得分固定为0）

---

## 建议解决方案

### 方案1：使用默认值（当前方案）
- 审计意见代码：使用 `np.nan`，该项得分固定为0
- 违规立案标识：使用默认值0，该项得分固定为1（因为0==0）
- 预告披露日：使用 `None`，该项得分固定为0

### 方案2：提供外部数据源
- 审计意见代码：从公告数据或Excel文件导入
- 违规立案标识：从监管公告或Excel文件导入
- 预告披露日：从公告数据或Excel文件导入

### 方案3：部分替代
- 违规立案标识：使用 `riskwarning` 作为参考（但不等同）
- 审计意见代码：使用 `auditor`（审计机构）作为参考（但无法获取意见代码）

---

## 需要您提供的数据

以下字段需要您提供其他数据源或手动维护：

1. **审计意见代码** - 需要知道每个股票在Q3报告期的审计意见代码（1=标准无保留意见，2=带强调事项段的无保留意见等）
2. **违规立案标识** - 需要知道每个股票是否存在违规立案（0=无，1=有）
3. **预告披露日** - 需要知道每个股票的业绩预告披露日期（格式：YYYY-MM-DD）

如果能够提供这些数据，可以：
- 以CSV文件形式提供（包含code和对应字段）
- 或以函数形式提供数据接口
- 代码中可以读取这些数据并合并到主数据中

---

## 当前状态

- ✅ 大部分财务数据字段可以正常获取
- ✅ 总市值、经营现金流等关键字段可以正常获取
- ❌ 3个字段无法获取：审计意见代码、违规立案标识、预告披露日
- ⚠️ 硬门槛6项中，有2项无法正常打分（硬门槛5和6）
- ⚠️ 软指标4项中，有1项无法正常打分（软指标4）

